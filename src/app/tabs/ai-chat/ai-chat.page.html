<ion-header [translucent]="true" class="ion-no-border">
  <ion-toolbar class="chat-header">
    <ion-title class="chat-title">
      <ion-icon name="chatbubble-outline" class="title-icon"></ion-icon>
      <span class="title-text">AI Remitter</span>
      <div class="ai-status" [class.connected]="isOpenAIConnected">
        <ion-icon [name]="isOpenAIConnected ? 'cloud-done-outline' : 'cloud-offline-outline'"></ion-icon>
        <span class="status-text">{{ isOpenAIConnected ? 'AI Connected' : 'Local AI' }}</span>
      </div>
    </ion-title>
    <ion-button fill="clear" slot="end" (click)="closeChatHandler()" class="close-btn">
      <ion-icon name="close-outline"></ion-icon>
    </ion-button>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="chat-content">
  <!-- Chat Messages -->
  <div class="chat-messages" #chatContainer>
    <div class="message-container" *ngFor="let message of messages">
      <div class="message" [class.user-message]="message.isUser" [class.ai-message]="!message.isUser">
        <div class="message-avatar" *ngIf="!message.isUser">
          <ion-avatar>
            <img src="assets/imgs/avatar.png" alt="AI Assistant" 
                 (error)="onImageError($event)" />
          </ion-avatar>
        </div>
        
        <div class="message-bubble">
          <div class="message-text">{{ message.text }}</div>
          <div class="message-time">
            {{ message.timestamp | date:'shortTime' }}
          </div>
          
          <!-- Show suggestions if available -->
          <div class="message-suggestions" *ngIf="message.suggestions && message.suggestions.length > 0">
            <div class="suggestions-title">ðŸ’¡ Try these:</div>
            <div class="suggestions-list">
              <ion-button 
                *ngFor="let suggestion of message.suggestions" 
                fill="clear" 
                size="small" 
                class="suggestion-btn"
                (click)="handleSuggestion(suggestion)"
              >
                {{ suggestion }}
              </ion-button>
            </div>
          </div>
        </div>
        
        <div class="message-avatar" *ngIf="message.isUser">
          <ion-avatar>
            <img src="assets/imgs/avatar-placeholder.png" alt="User" 
                 (error)="onImageError($event)" />
          </ion-avatar>
        </div>
      </div>
    </div>

    <!-- Quick Action Buttons (show only after welcome message) -->
    <div class="quick-actions" *ngIf="messages.length === 1">
      <div class="quick-actions-title">Quick Actions:</div>
      <div class="quick-actions-grid">
        <ion-button 
          fill="outline" 
          size="small" 
          class="quick-action-btn"
          (click)="handleQuickAction('airtime')"
        >
          <ion-icon name="phone-portrait-outline" slot="start"></ion-icon>
          Buy Airtime
        </ion-button>
        
        <ion-button 
          fill="outline" 
          size="small" 
          class="quick-action-btn"
          (click)="handleQuickAction('data')"
        >
          <ion-icon name="cellular-outline" slot="start"></ion-icon>
          Data Bundle
        </ion-button>
        
        <ion-button 
          fill="outline" 
          size="small" 
          class="quick-action-btn"
          (click)="handleQuickAction('transfer')"
        >
          <ion-icon name="swap-horizontal-outline" slot="start"></ion-icon>
          Send Money
        </ion-button>
        
        <ion-button 
          fill="outline" 
          size="small" 
          class="quick-action-btn"
          (click)="handleQuickAction('wallet')"
        >
          <ion-icon name="wallet-outline" slot="start"></ion-icon>
          Check Balance
        </ion-button>
      </div>
    </div>

    <!-- Typing Indicator -->
    <div class="message-container" *ngIf="isTyping">
      <div class="message ai-message">
        <div class="message-avatar">
          <ion-avatar>
            <img src="assets/imgs/avatar.png" alt="AI Assistant" 
                 (error)="onImageError($event)" />
          </ion-avatar>
        </div>
        <div class="message-bubble typing-bubble">
          <div class="typing-indicator">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Input Area -->
  <div class="chat-input-area">
    <div class="input-container">
      <ion-textarea
        [(ngModel)]="newMessage"
        placeholder="Type your message..."
        rows="1"
        autoGrow="true"
        maxlength="500"
        (keydown)="onKeyPress($event)"
        class="message-input"
      ></ion-textarea>
      
      <div class="input-actions">
        <ion-button
          fill="clear"
          class="voice-btn"
          (click)="startVoiceInput()"
          [disabled]="newMessage.trim().length > 0"
        >
          <ion-icon name="mic-outline"></ion-icon>
        </ion-button>
        
        <ion-button
          fill="clear"
          class="send-btn"
          (click)="sendMessage()"
          [disabled]="!newMessage.trim() || isLoading"
        >
          <ion-icon name="paper-plane-outline"></ion-icon>
        </ion-button>
      </div>
    </div>
  </div>
</ion-content> 