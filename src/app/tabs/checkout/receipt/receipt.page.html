<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="goToHome()">
        <ion-icon slot="icon-only" name="close-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Transaction Receipt</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div *ngIf="isLoading" class="ion-text-center ion-padding">
    <ion-spinner></ion-spinner>
    <p>Loading receipt...</p>
  </div>

  <div *ngIf="!isLoading && error" class="ion-text-center ion-padding">
    <ion-icon name="alert-circle" color="danger" style="font-size: 48px;"></ion-icon>
    <h2>Error</h2>
    <p>{{ error }}</p>
    <ion-button expand="block" (click)="goToHome()">Return Home</ion-button>
  </div>

  <div *ngIf="!isLoading && !error && transaction" class="receipt-container" #receiptContent>
    <!-- Success Header -->
    <div class="success-header ion-text-center ion-padding">
      <div class="success-icon">
        <ion-icon name="checkmark-circle" color="success"></ion-icon>
      </div>
      <h2 class="success-title">Payment Successful</h2>
      <div class="amount-display">
        <span class="currency">{{ transaction.currency || 'GHS' }}</span>
        <span class="amount">{{ transaction.amount | number:'1.2-2' }}</span>
      </div>
    </div>

    <!-- Transaction Details -->
    <div class="transaction-details">
      <h3 class="details-title">Transaction Details</h3>
      <ion-list lines="full" class="details-list">
      <ion-item>
        <ion-label>Status</ion-label>
        <ion-note slot="end" color="success">
          <ion-text color="success" *ngIf="transaction.status === 'COMPLETED' || transaction.status === 'SUCCESS'">
            Completed
          </ion-text>
          <ion-text color="warning" *ngIf="transaction.status === 'PENDING'">
            Pending
          </ion-text>
          <ion-text color="danger" *ngIf="transaction.status === 'FAILED' || transaction.status === 'ERROR'">
            Failed
          </ion-text>
        </ion-note>
      </ion-item>

      <ion-item class="transaction-id">
        <ion-label>Transaction ID</ion-label>
        <ion-note slot="end">{{ formatTransactionId(transaction.transactionId || transaction.trxn) }}</ion-note>
      </ion-item>

      <ion-item *ngIf="transaction.orderId">
        <ion-label>Order ID</ion-label>
        <ion-note slot="end">{{ transaction.orderId }}</ion-note>
      </ion-item>

      <ion-item *ngIf="transaction.recipientNumber" class="phone-number">
        <ion-label>Recipient</ion-label>
        <ion-note slot="end">{{ formatPhoneNumber(transaction.recipientNumber) }}</ion-note>
      </ion-item>

      <ion-item *ngIf="transaction.network">
        <ion-label>Network</ion-label>
        <ion-note slot="end">{{ transaction.network }}</ion-note>
      </ion-item>

      <ion-item *ngIf="transaction.timestamp">
        <ion-label>Date & Time</ion-label>
        <ion-note slot="end">{{ formatDate(transaction.timestamp) }}</ion-note>
      </ion-item>

      <ion-item *ngIf="transaction.message">
        <ion-label>Message</ion-label>
        <ion-note slot="end" class="ion-text-wrap">{{ transaction.message }}</ion-note>
      </ion-item>
    </ion-list>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons ion-padding">
      <ion-button expand="block" (click)="downloadOrShareReceipt('download')" [disabled]="isGeneratingPdf" class="ion-margin-bottom" color="primary">
        <ion-icon name="download-outline" slot="start"></ion-icon>
        {{ isGeneratingPdf ? 'Generating...' : 'Download Receipt' }}
      </ion-button>
      
      <ion-button expand="block" (click)="downloadOrShareReceipt('share')" [disabled]="isGeneratingPdf" class="ion-margin-bottom" color="secondary">
        <ion-icon name="share-social-outline" slot="start"></ion-icon>
        {{ isGeneratingPdf ? 'Preparing...' : 'Share Receipt' }}
      </ion-button>
      
      <ion-button expand="block" (click)="goToHome()" fill="clear" class="ion-margin-top">
        <ion-icon name="home-outline" slot="start"></ion-icon>
        Back to Home
      </ion-button>
    </div>
  </div>
</ion-content>
